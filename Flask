import discord
from discord.ext import commands

TOKEN = "MTQ3MDgwMTM5NjA2NzYwMjUzNA.GxRPGB.CKjWVGE08Ntd09hHr0-IvP7ID5P74PqVVP-ibo"
channelID = 1470782219940397206
banID = 1470871822986772722

intents = discord.Intents.default()
intents.members = True

bot = commands.Bot(command_prefix="!", intents=intents)


@bot.event
async def on_ready():
    print(f"Eingeloggt als {bot.user}")
    await bot.tree.sync()  # registriert Slash Commands
    activity = discord.Game(name="Joint discord.gg/XT8dmpperV")
    await bot.change_presence(status=discord.Status.online, activity=activity)


# ===== Button =====
class UnbanView(discord.ui.View):
    def __init__(self, user_id: int):
        super().__init__(timeout=None)
        self.user_id = user_id

    @discord.ui.button(label="Unban", style=discord.ButtonStyle.green)
    async def unban_button(self, interaction: discord.Interaction, button: discord.ui.Button):
        guild = interaction.guild
        user = await bot.fetch_user(self.user_id)

        await guild.unban(user)

        log_channel = bot.get_channel(banID)
        await log_channel.send(f"{user} wurde entbannt.")


# ===== Slash Ban =====
@bot.tree.command(name="ban", description="Bannt einen User")
@discord.app_commands.checks.has_permissions(ban_members=True)
async def ban(interaction: discord.Interaction, member: discord.Member, reason: str = "Kein Grund angegeben"):
    await member.ban(reason=reason)

    log_channel = bot.get_channel(banID)

    view = UnbanView(member.id)
    await log_channel.send(
        f"{member} wurde gebannt.\nGrund: {reason}",
        view=view
    )

bot.run(TOKEN)
